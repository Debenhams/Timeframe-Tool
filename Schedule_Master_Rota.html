<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Staff Schedule Manager</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f8f9fa;
    }

    h2 {
      text-align: center;
    }

    select, input, button {
      padding: 8px;
      margin: 5px 0;
      font-size: 16px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }

    th {
      background-color: #343a40;
      color: white;
    }

    .workflow {
      white-space: pre-wrap;
      text-align: left;
    }

    .amber { background-color: #FFC107; }
    .grey { background-color: #e0e0e0; }
    .blue { background-color: #B3E5FC; }
    .green { background-color: #C8E6C9; }
  </style>
</head>
<body>

  <h2>Staff Schedule Manager</h2>

  <label><strong>Select Staff:</strong></label>
  <select id="staffSelect" onchange="loadSchedule()">
    <option disabled selected>Select Staff</option>
  </select>
  <button onclick="addStaff()">Add New Staff</button>

  <div style="margin-top: 20px;">
    <label><strong>Edit Tasks (Monâ€“Fri):</strong></label><br>
    <textarea id="tasksInput" rows="10" style="width:100%;" placeholder='Format: Day|Shift|Hours|TaskName|TimeRange|Color (one per line)&#10;Example: Monday|11:00 - 20:00|9|Emails|11:00 - 13:15|amber'></textarea><br>
    <button onclick="saveTasks()">ðŸ’¾ Save Schedule</button>
  </div>

  <table>
    <thead>
      <tr id="dayRow"></tr>
    </thead>
    <tbody>
      <tr id="dateRow"></tr>
      <tr id="shiftRow"></tr>
      <tr id="hoursRow"></tr>
      <tr id="workflowRow"></tr>
    </tbody>
  </table>

  <script>
    const startDate = new Date("2025-10-06"); // Week start
    const days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"];

    let scheduleData = JSON.parse(localStorage.getItem("scheduleData") || "{}");

    const staffSelect = document.getElementById("staffSelect");

    function populateStaffDropdown() {
      staffSelect.innerHTML = `<option disabled selected>Select Staff</option>`;
      Object.keys(scheduleData).forEach(name => {
        const opt = document.createElement("option");
        opt.value = name;
        opt.textContent = name;
        staffSelect.appendChild(opt);
      });
    }

    function addStaff() {
      const name = prompt("Enter staff name:");
      if (name && !scheduleData[name]) {
        scheduleData[name] = [];
        localStorage.setItem("scheduleData", JSON.stringify(scheduleData));
        populateStaffDropdown();
        staffSelect.value = name;
        loadSchedule();
      }
    }

    function loadSchedule() {
      const name = staffSelect.value;
      const tasks = scheduleData[name] || [];

      // Reset rows
      ["dayRow", "dateRow", "shiftRow", "hoursRow", "workflowRow"].forEach(id => {
        document.getElementById(id).innerHTML = '';
      });

      let rawInput = '';
      for (let i = 0; i < 5; i++) {
        const date = new Date(startDate);
        date.setDate(date.getDate() + i);
        const day = days[i];
        const formattedDate = date.toLocaleDateString('en-US', { month: 'long', day: 'numeric' });

        const dayTasks = tasks.filter(t => t.day === day);
        const shift = dayTasks[0]?.shift || '-';
        const hours = dayTasks[0]?.hours || '-';

        let workflowHTML = '';
        dayTasks.forEach(task => {
          workflowHTML += `<div class="${task.color}">${task.task}: ${task.time}</div>`;
        });

        document.getElementById("dayRow").innerHTML += `<th>${day}</th>`;
        document.getElementById("dateRow").innerHTML += `<td>${formattedDate}</td>`;
        document.getElementById("shiftRow").innerHTML += `<td>${shift}</td>`;
        document.getElementById("hoursRow").innerHTML += `<td>${hours} hrs</td>`;
        document.getElementById("workflowRow").innerHTML += `<td class="workflow">${workflowHTML || '-'}</td>`;
      }

      // Populate textarea with existing tasks
      const taskText = tasks.map(t =>
        `${t.day}|${t.shift}|${t.hours}|${t.task}|${t.time}|${t.color}`
      ).join("\n");
      document.getElementById("tasksInput").value = taskText;
    }

    function saveTasks() {
      const name = staffSelect.value;
      const raw = document.getElementById("tasksInput").value.trim();
      const lines = raw.split("\n");
      const parsedTasks = [];

      for (let line of lines) {
        const [day, shift, hours, task, time, color] = line.split("|").map(v => v.trim());
        if (day && shift && hours && task && time && color) {
          parsedTasks.push({ day, shift, hours, task, time, color });
        }
      }

      scheduleData[name] = parsedTasks;
      localStorage.setItem("scheduleData", JSON.stringify(scheduleData));
      loadSchedule();
      alert("Schedule saved!");
    }

    // Initialize
    populateStaffDropdown();
  </script>
</body>
</html>
