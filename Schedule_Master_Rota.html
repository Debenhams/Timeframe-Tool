<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Professional Team Rota System â€” Supabase</title>
  <link rel="stylesheet" href="./styles/planner.css" />
</head>

<body>
  <header class="toolbar">
    <h1>Team Rota Planner</h1>

    <div class="controls">
      <label>View:</label>
      <select id="viewSelect" data-master-view-dropdown>
        <option value="">(Team Selected)</option>
      </select>

      <label>Week start:</label>
      <input type="date" id="weekStart" />

      <label>Day:</label>
      <select id="teamDay">
        <option>Monday</option>
        <option>Tuesday</option>
        <option>Wednesday</option>
        <option>Thursday</option>
        <option>Friday</option>
        <option>Saturday</option>
        <option>Sunday</option>
      </select>

      <button id="btnGenerate">Generate</button>
    </div>
  </header>

  <main>
    <!-- Left Panel: Tree / Leaders / Advisors -->
    <aside id="treePanel" class="sidebar">
      <h2>Leaders / Advisors</h2>
      <div id="advisorTree" data-tree-root></div>
    </aside>

    <!-- Center: Horizontal Planner -->
    <section id="plannerSection" class="planner">
      <div class="planner__header">
        <div class="planner__col--name">Name</div>
        <div class="planner__col--time" id="timeHeader"></div>
      </div>
      <div class="planner__body" id="plannerBody"></div>
    </section>

    <!-- Right Panel: Master Assignment -->
    <aside id="assignPanel" class="sidebar">
      <h2>Master Assignment</h2>
      <div id="assignTable"></div>
    </aside>
  </main>

  <!-- ===== Hidden Colour Palette (still editable in code) ===== -->
  <section id="palette" style="display:none;">
    <div class="color-palette">
      <div class="color-swatch c-email"></div>
      <div class="color-swatch c-mirakl"></div>
      <div class="color-swatch c-social"></div>
      <div class="color-swatch c-lunch"></div>
      <div class="color-swatch c-break"></div>
      <div class="color-swatch c-overtime"></div>
    </div>
  </section>

  <!-- ===== Dialogs ===== -->
  <dialog id="assignDialog">
    <form method="dialog">
      <h3>Assign</h3>
      <p>Select advisor / time / task</p>
      <menu>
        <button value="cancel">Cancel</button>
        <button id="confirmAssign" value="ok">OK</button>
      </menu>
    </form>
  </dialog>

  <dialog id="editBlockDialog">
    <form method="dialog">
      <h3>Edit Block</h3>
      <label>Task:
        <input id="blockTask" type="text" />
      </label>
      <label>Start:
        <input id="blockStart" type="time" />
      </label>
      <label>End:
        <input id="blockEnd" type="time" />
      </label>
      <menu>
        <button value="cancel">Cancel</button>
        <button id="saveBlockEdit" value="ok">Save</button>
      </menu>
    </form>
  </dialog>

  <dialog id="publishDialog">
    <form method="dialog">
      <h3>Publish Schedule</h3>
      <p>Confirm publish for all advisors?</p>
      <menu>
        <button value="cancel">Cancel</button>
        <button id="confirmPublish" value="ok">Publish</button>
      </menu>
    </form>
  </dialog>

  <!-- ===== Vertical Advisor Week View ===== -->
  <section id="advisorWeekSection" class="advisor-week">
    <h2>Advisor Week View</h2>
    <div id="advisorWeekBody"></div>
  </section>

  <!-- ===== Supabase & Runtime Setup ===== -->
  <script>
    const supabaseUrl = "YOUR_SUPABASE_URL";
    const supabaseKey = "YOUR_SUPABASE_ANON_KEY";
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    // Data caches
    window.ADVISORS_LIST = [];
    window.ADVISOR_BY_ID = new Map();
    window.ADVISOR_BY_NAME = new Map();
    window.ROTAS = new Map();
    window.TEMPLATES = {};
    window.selectedAdvisors = [];

    // Realtime updates
    window.subscribeRealtime = function() {
      if (!supabase) return;
      supabase.channel('rotas').on('postgres_changes',
        { event: '*', schema: 'public', table: 'rotas' },
        (payload) => {
          console.log('Realtime update:', payload);
          if (typeof window.refreshPlannerUI === 'function') {
            window.refreshPlannerUI();
          }
        }
      ).subscribe();
    };
  </script>

  <!-- ===== Initialization & Scripts ===== -->
  <script defer src="./src/planner.js"></script>
  <script defer src="./src/init.js"></script>
</body>
</html>