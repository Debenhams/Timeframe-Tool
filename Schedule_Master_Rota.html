<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Professional Team Rota System</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
        /* --- THEME & VARIABLES --- */
        :root{
            --primary-color: #0d47a1;
            --secondary-color: #fafafa;
            --background-dark: #263238;
            --accent-color: #00c853;
            --text-dark: #212121;
            --text-light: #ffffff;
            --border-color: #e0e0e0;
            --timeline-height: 1000px;

            /* activity defaults */
            --color-emails: #2ecc71;
            --color-mirakl: #ffb300;
            --color-social: #5e35b1;
            --color-overtime: #e53935;
            --color-meeting: #ffd700;
            --color-break: #90a4ae;
            --color-lunch: #ff8f00;
            --color-dayoff: #f4f4f4;
        }

        /* --- BASE --- */
        *{box-sizing:border-box}
        body{
            font-family: "Roboto", "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            margin:0;
            background:var(--secondary-color);
            color:var(--text-dark);
        }
        .header{
            background:var(--primary-color);
            color:var(--text-light);
            padding:28px 36px;
            box-shadow:0 4px 10px rgba(0,0,0,0.18);
        }
        .header h1{margin:0;font-size:1.9rem;font-weight:700}
        .container{padding:28px;max-width:1200px;margin:0 auto}
        h2{color:var(--primary-color);margin-top:28px;border-bottom:2px solid var(--border-color);padding-bottom:8px}

        /* controls */
        .controls-panel{
            background:var(--text-light);
            padding:14px;
            border-radius:8px;
            box-shadow:0 2px 8px rgba(0,0,0,0.06);
            margin-bottom:18px;
            display:flex;
            gap:12px;
            align-items:center;
            justify-content:space-between;
            flex-wrap:wrap;
        }
        input[type="date"], input[type="text"], input[type="time"], select{
            padding:8px 10px;border:1px solid var(--border-color);border-radius:6px;
        }
        button{
            background:var(--accent-color);color:var(--text-light);border:none;padding:8px 14px;border-radius:8px;cursor:pointer;font-weight:600
        }
        button.secondary{background:#1976d2}
        button.danger{background:#dc3545}
        .button-group{display:flex;gap:8px}

        .hidden{display:none !important}

        /* template editor */
        .template-row{
            display:flex;gap:10px;align-items:center;padding:10px;border-radius:6px;border:1px solid #cfd8dc;background:var(--secondary-color);flex-wrap:wrap;margin-bottom:10px
        }
        .template-row input[type="time"]{width:110px}
        .template-row input[type="text"]{width:120px}
        .template-row select{width:130px;padding:6px}

        /* master table */
        .master-table-container{overflow:auto;background:var(--text-light);border-radius:8px;padding:0;margin-bottom:16px;box-shadow:0 4px 12px rgba(0,0,0,0.05)}
        table.master-table{width:100%;border-collapse:collapse;min-width:760px}
        table.master-table th, table.master-table td{border:1px solid var(--border-color);padding:8px;text-align:center}
        table.master-table th{background:var(--primary-color);color:var(--text-light);font-weight:600}
        td.advisor-name-cell{text-align:left;font-weight:700;background:#e3f2fd;color:var(--text-dark);width:200px}

        /* timeline */
        #team-timeline-container{background:var(--text-light);padding:12px;border-radius:8px;box-shadow:0 8px 16px rgba(0,0,0,0.08);overflow:auto}
        .master-timeline-grid{display:grid;position:relative;gap:0;align-items:start}
        .time-axis{
            padding-right:10px;text-align:right;border-right:1px solid var(--border-color);position:relative;background:var(--text-light)
        }
        .time-label{position:absolute;font-size:0.8em;transform:translateY(-50%);left:0;width:100%;padding-right:6px;color:#616161;border-bottom:1px dashed #e0e0e0}
        .advisor-header{padding:10px 6px;text-align:center;font-weight:700;background:var(--primary-color);color:var(--text-light);position:sticky;top:0;z-index:20;border:1px solid var(--border-color)}
        .day-cell{position:relative;border:1px solid var(--border-color);height:var(--timeline-height);overflow:hidden;background:transparent}
        .activity-block{
            position:absolute;left:6%;width:88%;color:var(--text-light);padding:6px;border-radius:6px;font-size:0.78em;display:flex;flex-direction:column;align-items:center;justify-content:center;box-shadow:0 1px 3px rgba(0,0,0,0.15);font-weight:600;cursor:help;overflow:hidden;text-overflow:ellipsis;white-space:nowrap
        }
        .activity-time{font-size:0.72em;font-weight:400;display:block;opacity:0.95}
        .day-off-label{position:absolute;top:50%;transform:translateY(-50%);width:100%;text-align:center;color:#bdbdbd;font-size:1.05em;font-weight:700}

        /* color key layout */
        .color-key-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
        .color-input-group{display:flex;gap:8px;align-items:center}
        .color-example{display:inline-block;width:18px;height:18px;border-radius:4px;border:1px solid rgba(0,0,0,0.08)}

        /* print */
        @media print{
            .header,.controls-panel,button{display:none !important}
            .container{padding:0}
            .master-timeline-grid{page-break-inside:avoid}
            .day-cell{height:1200px !important}
            body{background:#fff}
        }

        /* small screens */
        @media (max-width:820px){
            .controls-panel{flex-direction:column;align-items:stretch}
            .template-row{flex-direction:column;align-items:stretch}
        }
    </style>
</head>
<body>
    <div class="header"><h1>Professional Team Rota System</h1></div>

    <div class="container">
        <div class="controls-panel">
            <div style="display:flex;gap:12px;align-items:center">
                <label for="start-date-input" style="font-weight:700">Week Start Date (Monday):</label>
                <input id="start-date-input" type="date" onchange="updateDates()" />
            </div>

            <div class="button-group">
                <button onclick="saveData(true)">üíæ Save & Download Data</button>
                <button class="secondary" onclick="toggleSettings()">‚öôÔ∏è Toggle Settings/Templates</button>
                <button onclick="generateAllSchedules()">üöÄ Generate Timeline View</button>
            </div>
        </div>

        <div id="settings-area" class="controls-panel hidden" style="align-items:flex-start">
            <div style="width:58%">
                <h2 style="color:var(--text-dark);">üõ†Ô∏è Shift Template Builder</h2>
                <div id="template-editor" style="padding:10px"></div>
                <div style="margin-top:8px">
                    <button onclick="addTemplate()">‚ûï Add New Shift Template</button>
                    <button class="danger" onclick="resetTemplates()" style="margin-left:8px">Reset Templates</button>
                </div>
            </div>

            <div style="width:40%">
                <h2 style="color:var(--text-dark);">üé® Activity Color Key</h2>
                <div class="color-key-grid" style="padding:10px;background:var(--secondary-color);border-radius:6px">
                    <div class="color-input-group"><span class="color-example" data-activity="emails" style="background:var(--color-emails)"></span><label>Emails:</label><input id="color-emails" type="text" value="#2ecc71" oninput="updateColors()" /></div>
                    <div class="color-input-group"><span class="color-example" data-activity="mirakl" style="background:var(--color-mirakl)"></span><label>Mirakl:</label><input id="color-mirakl" type="text" value="#ffb300" oninput="updateColors()" /></div>
                    <div class="color-input-group"><span class="color-example" data-activity="social" style="background:var(--color-social)"></span><label>Social:</label><input id="color-social" type="text" value="#5e35b1" oninput="updateColors()" /></div>
                    <div class="color-input-group"><span class="color-example" data-activity="meeting" style="background:var(--color-meeting)"></span><label>Meeting/Coach:</label><input id="color-meeting" type="text" value="#ffd700" oninput="updateColors()" /></div>
                    <div class="color-input-group"><span class="color-example" data-activity="overtime" style="background:var(--color-overtime)"></span><label>Overtime:</label><input id="color-overtime" type="text" value="#e53935" oninput="updateColors()" /></div>
                    <div class="color-input-group"><span class="color-example" data-activity="break" style="background:var(--color-break)"></span><label>Break:</label><input id="color-break" type="text" value="#90a4ae" oninput="updateColors()" /></div>
                    <div class="color-input-group"><span class="color-example" data-activity="lunch" style="background:var(--color-lunch)"></span><label>Lunch:</label><input id="color-lunch" type="text" value="#ff8f00" oninput="updateColors()" /></div>
                </div>

                <div style="margin-top:12px" class="button-group">
                    <input id="load-file" type="file" accept=".json" style="display:none" onchange="loadData(event)" />
                    <button onclick="document.getElementById('load-file').click()">üìÇ Load Data from File</button>
                    <button onclick="downloadData(collectFullData())" style="margin-left:8px">‚¨áÔ∏è Export JSON</button>
                </div>
            </div>
        </div>

        <h2>üìÖ Master Rota Assignment Grid</h2>
        <div class="master-table-container">
            <table class="master-table" id="master-rota-table">
                <thead>
                    <tr>
                        <th rowspan="2" class="advisor-name-cell" style="width:200px">Advisor</th>
                        <th colspan="7">Select Shift Template</th>
                    </tr>
                    <tr id="date-headers"></tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <div style="margin:10px 0">
            <button onclick="generateAllSchedules()">üöÄ Generate Timeline View</button>
        </div>

        <h2 style="margin-top:22px">üìä Team Weekly Timeline Schedule</h2>
        <div id="team-timeline-container">
            <div class="master-timeline-grid" id="master-timeline-grid">
                <p style="padding:20px;text-align:center;color:var(--text-dark)">Select your shifts in the grid above and click 'Generate Timeline View' to see the schedule.</p>
            </div>
        </div>

        <div style="margin-top:12px">
            <button onclick="printGeneratedSchedule()">üñ®Ô∏è Download Team Rota (PDF)</button>
        </div>
    </div>

    <script>
        /* ==========================
           CONFIG / DEFAULTS
           ========================== */
        const ADVISOR_NAMES = [
            'Luke Pashley','Ameena Malik','Carrie-Ann Raw','Danielle Smith',
            'Farwa Shaheen','Gemma Emmett','Laura Stockburn','Millie Walsh','Tunis Foley'
        ];
        const DAYS_FULL = ['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday'];
        const PLATFORM_ACTIVITIES = ['Emails','Mirakl','Social','Overtime','Meeting'];
        const BREAK_SLOTS = ['Break1','Lunch','Break2'];
        const STORAGE_KEY = 'ultraFastRotasV4';

        // timeline configuration (one place)
        const START_HOUR = 7;
        const END_HOUR = 20;
        const TIMELINE_HEIGHT_PX = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--timeline-height')) || 1000;
        const TOTAL_HOURS = END_HOUR - START_HOUR;
        const HEIGHT_PER_HOUR = TIMELINE_HEIGHT_PX / TOTAL_HOURS;
        const HEIGHT_PER_MINUTE = HEIGHT_PER_HOUR / 60;

        let masterRotaData = {}; // structure: { advisor: { Monday: {

