<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Professional Team Rota System</title>

<!-- Flatpickr (Calendar) CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

<!-- Main App CSS -->
<link rel="stylesheet" href="./styles/planner.css?v=5" />

<!-- Supabase Client -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  
  <!-- Top Header Bar -->
  <div class="topbar">
    <h1>Professional Team Rota System</h1>
    <div class="topbar-controls">
      <label for="weekStart">Week Start (Monday)</label>
      <input type="date" id="weekStart" class="input" />
      <button class="btn subtle icon-btn" id="btnToday" title="Go to Today">üìÖ</button>
      <button class="btn subtle icon-btn" id="prevWeek" title="Previous Week">‚óÄ</button>
      <button class="btn subtle icon-btn" id="nextWeek" title="Next Week">‚ñ∂</button>
      
      <button class="btn" id="btnCommitWeek" style="margin-left: 24px;">
        üíæ Commit Week
      </button>
      <button class="btn subtle icon-btn" id="btnUndo" title="Undo">‚Ü©Ô∏è</button>
      <button class="btn subtle icon-btn" id="btnRedo" title="Redo">‚Ü™Ô∏è</button>

      <button class="btn subtle icon-btn" id="btnPrint" title="Print" style="margin-left: 24px;">üñ®Ô∏è</button>
    </div>
  </div>

  <!-- Main 3-Column Layout -->
  <div class="main-layout">
    
    <!-- Left Panel: Planning Hub (Tabs) -->
    <div class="panel planning-hub">
      <div class="tab-bar">
        <button class="tab-btn active" data-tab="tab-rotations">Rotation Editor</button>
        <button class="tab-btn" data-tab="tab-assignments">Advisor Assignments</button>
      </div>

      <!-- Tab 1: Rotation Editor -->
      <div class="tab-content active" id="tab-rotations">
        <div class="panel-header">
          <div class="input-group">
            <label for="rotationSelect">Rotation Family</label>
            <select id="rotationSelect" class="input"></select>
          </div>
          <div class="btn-group">
            <button class="btn subtle" id="btnNewRotation">[+] New</button>
            <button class="btn" id="btnSaveRotation">üíæ Save</button>
            <button class="btn danger" id="btnDeleteRotation" style="margin-left: 8px;">üóëÔ∏è Delete</button>
          </div>
        </div>
        <div class="panel-body">
          <p class="muted-text">Define the multi-week pattern for this rotation. Select a shift template (e.g., "7A", "RDO") for each day.</p>
          <div class="rotation-editor-grid" id="rotationEditorGrid">
            <!-- Grid will be generated by JS -->
          </div>
        </div>
      </div>

      <!-- Tab 2: Advisor Assignments -->
      <div class="tab-content" id="tab-assignments">
        <div class="panel-header">
          <h2>Advisor Assignments</h2>
          <span class="muted-text" style="margin-left: auto;">Assign a rotation and start date to each advisor.</span>
        </div>
        <div class="panel-body panel-body-table">
          <table class="assignment-table">
            <thead>
              <tr>
                <th>Advisor</th>
                <th>Assigned Rotation</th>
                <th>Rotation Start Date (Week 1)</th>
              </tr>
            </thead>
            <tbody id="assignmentTableBody">
              <!-- Rows will be generated by JS -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Right Panel: Schedules & Timeline -->
    <div class="panel schedules-panel">
      <!-- Schedules Tree -->
      <div class="schedules-tree-container">
        <div class="panel-header">
          <h2>Schedules</h2>
          <div class="input-group">
            <input type="text" id="treeSearch" class="input" placeholder="Filter sites/leaders/advisors..." />
            <button class="btn subtle" id="btnClearSelection">Clear</button>
          </div>
        </div>
        <div class="panel-body" id="schedulesTree">
          <!-- Tree will be generated by JS -->
          <div class="input-group" style="padding: 0 12px 12px;">
            <input type="checkbox" id="checkSelectAllAdvisors" />
            <label for="checkSelectAllAdvisors" style="font-weight: 800; font-size: 14px;">Select All Advisors</label>
          </div>
          <div id="tree-container"></div>
        </div>
      </div>
      
      <!-- Team Schedule (Horizontal Planner) -->
      <div class="team-schedule-container">
        <div class="panel-header">
          <h2 id="plannerTitle">Team Schedule</h2>
          <div class="btn-group">
            <select id="teamDay" class="input">
              <option>Monday</option>
              <option>Tuesday</option>
              <option>Wednesday</option>
              <option>Thursday</option>
              <option>Friday</option>
              <option>Saturday</option>
              <option>Sunday</option>
            </select>
          </div>
        </div>
        <div class="planner-container" id="teamPlanner">
          <div class="planner-header">
            <div class="planner-name-col">Name</div>
            <div class="planner-timeline-header" id="plannerTimelineHeader">
              <!-- Ticks will be generated by JS -->
            </div>
          </div>
          <div class="planner-body" id="plannerBody">
            <!-- Planner rows will be generated by JS -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div id="loadingOverlay">
    <div class="spinner"></div>
    <p>Loading Data...</p>
  </div>

  <!-- Toast/Notification -->
  <div id="toastNotification"></div>

  <!-- Supabase Config -->
  <script>
    const SUPABASE_URL = "https://oypdnjxhjpgpwmkltzmk.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im95cGRuanhoanBncHdta2x0em1rIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk4Nzk0MTEsImV4cCI6MjA3NTQ1NTQxMX0.Hqf1L4RHpIPUD4ut2uVsiGDsqKXvAjdwKuotmme4_Is";
    
    // *** THIS IS THE FIX ***
    // We must use "window.supabase.createClient" to access the client from the CDN script.
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  </script>

  <!-- Flatpickr (Calendar) JS -->
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

  <!-- App Scripts -->
  <script src="./src/planner.js?v=5"></script>
  <script src="./src/init.js?v=5"></script>

</body>
</html>

