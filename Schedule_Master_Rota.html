<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Professional Team Rota System — Supabase</title>

<!-- 
  VERSION 3:
  Cache-busted to load all new styles and logic.
-->
<link rel="stylesheet" href="./styles/planner.css?v=3" />
<link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet" />

<!-- Supabase client library -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

  <!-- ======================================= -->
  <!-- TOP APPLICATION BAR -->
  <!-- ======================================= -->
  <div class="topbar">
    <div class="topbar-left">
      <i class="ri-calendar-event-line"></i>
      <h1>Professional Team Rota System</h1>
    </div>
    <div class="topbar-center">
      <div class="week-nav">
        <button class="btn icon" id="prevWeek" title="Previous Week"><i class="ri-arrow-left-s-line"></i></button>
        <button class="btn subtle" id="btnToday" title="Go to Today"><i class="ri-calendar-today-line"></i> Today</button>
        <input type="date" id="weekStart" class="input" />
        <button class="btn icon" id="nextWeek" title="Next Week"><i class="ri-arrow-right-s-line"></i></button>
      </div>
    </div>
    <div class="topbar-right">
      <button class="btn subtle" id="btnUndo" title="Undo (Ctrl+Z)"><i class="ri-reply-line"></i></button>
      <button class="btn subtle" id="btnRedo" title="Redo (Ctrl+Y)"><i class="ri-share-forward-line"></i></button>
      <button class="btn" id="btnCommitWeek"><i class="ri-save-3-line"></i> Commit Week</button>
      <button class="btn subtle icon no-print" id="btnPrint" title="Print"><i class="ri-printer-line"></i></button>
    </div>
  </div>

  <!-- ======================================= -->
  <!-- MAIN APPLICATION LAYOUT (FULL WIDTH) -->
  <!-- ======================================= -->
  <div class="layout">

    <!-- == LEFT PANEL: PLANNING HUB == -->
    <div class="panel panel-hub">
      <div class="panel-header tab-bar">
        <button class="tab-button active" data-tab="tab-rotations"><i class="ri-refresh-line"></i> Rotation Editor</button>
        <button class="tab-button" data-tab="tab-assignments"><i class="ri-user-line"></i> Advisor Assignments</button>
      </div>

      <!-- TAB 1: ROTATION EDITOR (Phase 2) -->
      <div class="panel-body tab-content active" id="tab-rotations">
        <div class="rotation-editor-controls">
          <label for="rotationSelect" class="form-label">Rotation Family:</label>
          <select id="rotationSelect" class="input">
            <option value="">(loading...)</option>
          </select>
          <button class="btn subtle" id="btnNewRotation" title="New Rotation"><i class="ri-add-line"></i> New</button>
          <button class="btn subtle" id="btnSaveRotation" title="Save Rotation"><i class="ri-save-line"></i> Save</button>
          <button class="btn danger" id="btnDeleteRotation" title="Delete Rotation" style="margin-left: auto;"><i class="ri-delete-bin-line"></i></button>
        </div>
        <p class="muted-text">Define the multi-week pattern for this rotation. Select a shift template (e.g., "7A", "9C", "RDO") for each day.</p>
        <div class="table-wrap-condensed" id="rotationEditorGrid">
          <!-- Rotation Editor Grid will be generated by JS -->
        </div>
      </div>

      <!-- TAB 2: ADVISOR ASSIGNMENTS (Phase 2) -->
      <div class="panel-body tab-content" id="tab-assignments" style="display: none;">
        <p class="muted-text">Assign a rotation and its "Week 1" start date to each advisor. The system will auto-calculate their schedule from this.</p>
        <div class="table-wrap-condensed">
          <table class="data-table" id="advisorAssignmentTable">
            <thead>
              <tr>
                <th>Advisor</th>
                <th>Assigned Rotation</th>
                <th>Rotation Start Date (Week 1)</th>
              </tr>
            </thead>
            <tbody>
              <!-- Advisor assignments will be generated by JS -->
            </tbody>
          </table>
        </div>
      </div>

    </div>

    <!-- == RIGHT PANEL: SCHEDULES & VIEW == -->
    <div class="panel panel-schedules">
      <div class="panel-header">
        <h2>Schedules</h2>
        <div class="view-toggle seg">
          <button class="active" id="viewToggleHorizontal" title="Horizontal View"><i class="ri-layout-row-line"></i></button>
          <button id="viewToggleVertical" title="Vertical View"><i class="ri-layout-column-line"></i></button>
        </div>
      </div>
      <div class="panel-body">
        <div class="tree-search">
          <input id="treeSearch" class="input" placeholder="Filter sites / leaders / advisors…" style="flex:1" />
          <button class="btn subtle" id="btnClearSel">Clear</button>
        </div>
        <div class="tree" id="tree"></div>
        <div class="chip-container" id="activeChips"></div>
      </div>
    </div>
  </div>

  <!-- ======================================= -->
  <!-- SCHEDULE VIEWER (HORIZONTAL & VERTICAL) -->
  <!-- ======================================= -->
  <div class="view-container">
    <div class="panel" id="horizontalView">
      <div class="panel-header">
        <h2 id="horizontalTitle">Team Schedule</h2>
        <div class="form-group" style="margin-left: auto;">
          <label for="teamDay" class="form-label">Day:</label>
          <select id="teamDay" class="input">
            <option>Monday</option><option>Tuesday</option><option>Wednesday</option><option>Thursday</option>
            <option>Friday</option><option>Saturday</option><option>Sunday</option>
          </select>
        </div>
      </div>
      <section id="teamPlanner" class="planner">
        <div class="planner__header">
          <div class="planner__col--name">Name</div>
          <div class="planner__col--time" id="timeHeader"></div>
        </div>
        <div class="planner__body" id="plannerBody"></div>
      </section>
    </div>

    <div class="panel" id="verticalView" style="display: none;">
      <div class="panel-header">
        <h2 id="verticalTitle">Advisor Week (Calendar)</h2>
      </div>
      <div class="panel-body calendar">
        <div class="cal-grid" id="calGrid">
          <div class="hour-col"><div id="hours"></div></div>
        </div>
      </div>
    </div>
  </div>


  <!-- ======================================= -->
  <!-- DIALOGS -->
  <!-- ======================================= -->

  <!-- Commit confirmation dialog -->
  <dialog id="commitDlg">
    <div class="dialog-header"><i class="ri-save-3-line"></i> Commit Week Schedule</div>
    <div class="muted" id="commitSummary" style="margin-bottom:8px"></div>
    <div id="commitList" class="dialog-list"></div>
    <div class="dialog-actions">
      <button onclick="commitDlg.close()" class="btn subtle">Cancel</button>
      <button id="commitOK" class="btn">Commit</button>
    </div>
  </dialog>
  
  <!-- Tooltip -->
  <div id="tooltip" class="tooltip" style="display: none;"></div>

  <!-- 
    VERSION 3:
    Cache-busted to load all new logic.
  -->
  <script src="./src/planner.js?v=3"></script>
  <script src="./src/init.js?v=3"></script>

</body>
</html>

