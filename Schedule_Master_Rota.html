<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Professional Team Rota System</title>
  
  <!-- Flatpickr (Calendar) Styles -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  
  <!-- Main Stylesheet -->
  <link rel="stylesheet" href="./styles/planner.css?v=7" />

  <!-- Supabase Client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

  <!-- TOP BAR -->
  <header class="top-bar">
    <h1>Professional Team Rota System</h1>
    <div class="top-bar-controls">
      <label for="weekStart">Week Start (Monday)</label>
      <input type="text" id="weekStart" class="week-picker" placeholder="Select week..." />
      
      <button id="prevWeek" class="btn-icon" title="Previous Week">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
      </button>
      <button id="nextWeek" class="btn-icon" title="Next Week">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
      </button>
      
      <button id="btnCommit" class="btn btn-primary" title="Commit schedule changes to database">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
        Commit Week
      </button>
      
      <div class="separator"></div>
      
      <button id="btnUndo" class="btn-icon" title="Undo (Ctrl+Z)" disabled>
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 7v6h-6"></path><path d="M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l-3 2.7"></path></svg>
      </button>
      <button id="btnRedo" class="btn-icon" title="Redo (Ctrl+Y)" disabled>
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 17v-6h6"></path><path d="M21 7a9 9 0 0 1-9 9 9 9 0 0 1-6-2.3l3-2.7"></path></svg>
      </button>
      
      <div class="separator"></div>

      <button id="btnPrint" class="btn-icon" title="Print Schedule">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 6 2 18 2 18 9"></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect></svg>
      </button>
    </div>
  </header>
  
  <!-- MAIN APP LAYOUT -->
  <div class="app-layout">
    
    <!-- LEFT PANEL: Main Editors -->
    <main class="main-content">
      
      <!-- TABS -->
      <nav class="tab-nav">
        <button class="tab-link active" data-tab="tab-rotation-editor">Rotation Editor</button>
        <button class="tab-link" data-tab="tab-advisor-assignments">Advisor Assignments</button>
      </nav>

      <!-- TAB 1: ROTATION EDITOR -->
      <section id="tab-rotation-editor" class="tab-content active">
        <div class="editor-controls">
          <div class="form-group">
            <label for="rotationFamily">Rotation Family</label>
            <select id="rotationFamily" class="form-select"></select>
          </div>
          <div class="editor-buttons">
            <button id="btnNewRotation" class="btn btn-secondary">[+] New</button>
            <button id="btnSaveRotation" class="btn btn-primary">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
              Save
            </button>
            <button id="btnDeleteRotation" class="btn btn-danger">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
              Delete
            </button>
          </div>
        </div>
        <p class="helper-text">Define the multi-week pattern for this rotation. Select a shift template (e.g. "7A", "RDO") for each day.</p>
        <div class="table-container" id="rotationGrid">
          <!-- Rotation grid will be generated by JS -->
        </div>
      </section>
      
      <!-- TAB 2: ADVISOR ASSIGNMENTS -->
      <section id="tab-advisor-assignments" class="tab-content">
        <div class="table-container" id="assignmentGrid">
          <!-- Advisor assignment table will be generated by JS -->
        </div>
      </section>

      <!-- HORIZONTAL PLANNER (MOVED HERE) -->
      <section class="planner-section">
        <div class="planner-header">
          <h2>Team Schedule</h2>
          <div class="planner-day-toggle">
            <label for="plannerDay">Day:</label>
            <select id="plannerDay" class="form-select">
              <option value="Monday">Monday</option>
              <option value="Tuesday">Tuesday</option>
              <option value="Wednesday">Wednesday</option>
              <option value="Thursday">Thursday</option>
              <option value="Friday">Friday</option>
              <option value="Saturday">Saturday</option>
              <option value="Sunday">Sunday</option>
            </select>
          </div>
        </div>
        
        <div class="timeline-container">
          <div class="timeline-header">
            <div class="header-name">Name</div>
            <div class="header-timeline" id="timeHeader">
              <!-- Ticks generated by JS -->
            </div>
          </div>
          <div class="timeline-body" id="plannerBody">
            <!-- Rows generated by JS -->
          </div>
        </div>
      </section>

    </main>
    
    <!-- RIGHT SIDEBAR: Schedules (Advisors) -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2>Schedules</h2>
        <div class="sidebar-controls">
          <input type="text" id="treeSearch" class="form-input" placeholder="Filter sites/leaders/advisors...">
          <button id="btnClearSelection" class="btn btn-secondary">Clear</button>
        </div>
      </div>
      <div class="schedules-tree" id="schedulesTree">
        <!-- Tree generated by JS -->
      </div>
    </aside>

  </div> <!-- .app-layout -->

  <!-- App-wide notification system -->
  <div id="notification-container"></div>

  <!-- Supabase Config & Init -->
  <script>
    // These are provided by the environment
    const SUPABASE_URL = "https://oypdnjxhjpgpwmkltzmk.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im95cGRuanhoanBncHdta2x0em1rIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk4Nzk0MTEsImV4cCI6MjA3NTQ1NTQxMX0.Hqf1L4RHpIPUD4ut2uVsiGDsqKXvAjdwKuotmme4_Is";
    
    // Create a single, global Supabase client
    // FIX v6: Use window.supabase.createClient to avoid ReferenceError
    const supabase = (window.supabase && window.supabase.createClient)
      ? window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
      : null;
    
    if (!supabase) {
      console.error("Supabase client failed to initialize. Check CDN script.");
      document.body.innerHTML = "<h1>Error: Supabase client failed to initialize.</h1>";
    }
  </script>
  
  <!-- Flatpickr (Calendar) JS -->
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

  <!-- Project Scripts -->
  <script src="./src/planner.js?v=7"></script>
  <script src="./src/init.js?v=7"></script>

</body>
</html>

