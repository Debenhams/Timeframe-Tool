<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Customer Service Timeframe Tool</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f4f4f4;
        color: #333;
    }
    h2 {
        margin-top: 30px;
        color: #444;
    }
    label {
        font-weight: bold;
    }
    input[type="date"] {
        padding: 5px;
        margin: 5px 0;
    }
    .result {
        margin-top: 10px;
        padding: 10px;
        border-radius: 5px;
    }
    .badge {
        padding: 5px 10px;
        border-radius: 5px;
        color: white;
        font-weight: bold;
    }
    .badge.green { background-color: green; }
    .badge.orange { background-color: orange; }
    .badge.red { background-color: red; }
    .progress-bar {
        width: 100%;
        background-color: #ddd;
        border-radius: 5px;
        overflow: hidden;
        margin-top: 5px;
    }
    .progress {
        height: 10px;
        background-color: #4caf50;
        width: 0;
        transition: width 0.5s ease-in-out;
    }
    #spinner {
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(255, 255, 255, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
    }
    #spinner div {
        width: 50px;
        height: 50px;
        border: 5px solid #ccc;
        border-top: 5px solid #4caf50;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }
    @keyframes spin {
        0% { transform: rotate(0deg);}
        100% { transform: rotate(360deg);}
    }
    button {
        margin-top: 5px;
        padding: 5px 10px;
        cursor: pointer;
    }
</style>
</head>
<body>

<div id="spinner"><div></div></div>

<h1>Customer Service Timeframe Tool</h1>

<!-- Refund Completion -->
<h2>Refund Completion Dates</h2>
<label>Enter Refund Start Date:</label>
<input type="date" id="refundDate" onchange="calcRefund()">
<div id="refundResult" class="result"></div>
<button onclick="copyResult('refundResult')">Copy</button>

<!-- Return Deadline -->
<h2>Return Deadline Calculator</h2>
<label>Enter Delivery Date:</label>
<input type="date" id="returnDate" onchange="calcReturn()">
<div id="returnResult" class="result"></div>
<button onclick="copyResult('returnResult')">Copy</button>

<!-- NRG Completion -->
<h2>NRG Completion Date</h2>
<label>Enter Last Tracked Date:</label>
<input type="date" id="nrgDate" onchange="calcNRG()">
<div id="nrgResult" class="result"></div>
<button onclick="copyResult('nrgResult')">Copy</button>

<!-- PA Resolution -->
<h2>PA Resolution</h2>
<label>Enter Dispatch Date:</label>
<input type="date" id="paDate" onchange="calcPA()">
<div id="paResult" class="result"></div>
<button onclick="copyResult('paResult')">Copy</button>

<script>
document.addEventListener("DOMContentLoaded", function(){
    setTimeout(() => document.getElementById("spinner").style.display = "none", 1000);
});

// Format UK date
function formatUK(date) {
    return date.toLocaleDateString('en-GB');
}

// Status badge
function getBadge(daysLeft) {
    if (daysLeft > 3) return '<span class="badge green">On Track</span>';
    if (daysLeft >= 0) return '<span class="badge orange">Due Soon</span>';
    return '<span class="badge red">Overdue</span>';
}

// Progress bar
function getProgress(start, end) {
    const total = (end - start) / (1000*60*60*24);
    const done = (new Date() - start) / (1000*60*60*24);
    const percent = Math.min(100, Math.max(0, (done / total) * 100));
    return `<div class="progress-bar"><div class="progress" style="width:${percent}%"></div></div>`;
}

// Copy to clipboard
function copyResult(id) {
    const text = document.getElementById(id).innerText;
    navigator.clipboard.writeText(text);
    alert("Copied to clipboard!");
}

// Refund example (unchanged from last working version)
function calcRefund() {
    const date = new Date(document.getElementById("refundDate").value);
    if (!date.getTime()) return;
    const methods = { "Card":19, "Klarna":15, "Apple Pay":19, "PayPal":15 };
    let html = "";
    for (let m in methods) {
        let due = new Date(date);
        due.setDate(due.getDate() + methods[m]);
        let daysLeft = Math.ceil((due - new Date())/(1000*60*60*24));
        html += `<p>${m} Refund Due: ${formatUK(due)} ${getBadge(daysLeft)} (${daysLeft} days left) ${getProgress(date, due)}</p>`;
    }
    document.getElementById("refundResult").innerHTML = html;
}

// Return Deadline
function calcReturn() {
    const date = new Date(document.getElementById("returnDate").value);
    if (!date.getTime()) return;
    let due = new Date(date);
    due.setDate(due.getDate() + 28);
    let daysLeft = Math.ceil((due - new Date())/(1000*60*60*24));
    document.getElementById("returnResult").innerHTML =
        `Return Deadline: ${formatUK(due)} ${getBadge(daysLeft)} (${daysLeft} days left) ${getProgress(date, due)}`;
}

// NRG (11 days from last tracked)
function calcNRG() {
    const date = new Date(document.getElementById("nrgDate").value);
    if (!date.getTime()) return;
    let due = new Date(date);
    due.setDate(due.getDate() + 11);
    let daysLeft = Math.ceil((due - new Date())/(1000*60*60*24));
    document.getElementById("nrgResult").innerHTML =
        `NRG is 11 days since last tracked (UK) - Due: ${formatUK(due)} ${getBadge(daysLeft)} (${daysLeft} days left) ${getProgress(date, due)}`;
}

// PA (6 days from dispatch)
function calcPA() {
    const date = new Date(document.getElementById("paDate").value);
    if (!date.getTime()) return;
    let due = new Date(date);
    due.setDate(due.getDate() + 6);
    let daysLeft = Math.ceil((due - new Date())/(1000*60*60*24));
    document.getElementById("paResult").innerHTML =
        `PA is 6 days since dispatch - Deadline: ${formatUK(due)} ${getBadge(daysLeft)} (${daysLeft} days left) ${getProgress(date, due)}`;
}
</script>

</body>
</html>
