<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advisor Timeframe Tool</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2 { margin-top: 30px; }
    label { display: block; margin-top: 10px; }
    input { margin-bottom: 10px; padding: 5px; }
    .result { font-weight: bold; margin-top: 5px; }
    .badge { padding: 5px 10px; border-radius: 5px; color: white; }
    .badge.green { background-color: green; }
    .badge.orange { background-color: orange; }
    .badge.red { background-color: red; }
    .progress { width: 100%; background-color: #ddd; border-radius: 5px; overflow: hidden; height: 20px; margin-top: 5px; }
    .progress-bar { height: 100%; transition: width 0.5s; }
    #spinner { 
        position: fixed; 
        width: 100%; 
        height: 100%; 
        top: 0; 
        left: 0; 
        background: white; 
        display: flex; 
        justify-content: center; 
        align-items: center; 
        z-index: 9999;
    }
    #spinner div {
        border: 8px solid #f3f3f3;
        border-top: 8px solid #3498db;
        border-radius: 50%;
        width: 60px;
        height: 60px;
        animation: spin 1s linear infinite;
    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    button { margin-top: 5px; padding: 5px 10px; cursor: pointer; }
</style>
</head>
<body>

<div id="spinner"><div></div></div>

<h1>Advisor Timeframe Tool</h1>

<!-- Refund Completion Dates -->
<h2>Refund Completion Dates</h2>
<label>Enter Start Date:</label>
<input type="date" id="refundDate">
<button onclick="calculateRefunds()">Calculate</button>
<div id="refundResults"></div>

<!-- Return Deadline -->
<h2>Return Deadline Calculator</h2>
<label>Enter Delivery Date:</label>
<input type="date" id="returnDate">
<button onclick="calculateReturn()">Calculate</button>
<div id="returnResult"></div>

<!-- NRG Completion -->
<h2>NRG Completion Date</h2>
<label>Enter Last Tracked Date:</label>
<input type="date" id="nrgDate">
<button onclick="calculateNRG()">Calculate</button>
<div id="nrgResult"></div>

<!-- PA Resolution -->
<h2>PA Resolution</h2>
<label>Enter Dispatch Date:</label>
<input type="date" id="paDate">
<button onclick="calculatePA()">Calculate</button>
<div id="paResult"></div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    setTimeout(() => document.getElementById("spinner").style.display = "none", 800);
});

function formatUK(date) {
    return date.toLocaleDateString("en-GB");
}

function addDays(date, days) {
    let result = new Date(date);
    result.setDate(result.getDate() + days);
    return result;
}

function getBadge(daysLeft) {
    if (daysLeft > 3) return '<span class="badge green">On Track</span>';
    if (daysLeft >= 1) return '<span class="badge orange">Approaching</span>';
    return '<span class="badge red">Overdue</span>';
}

function progressBar(total, left) {
    let percent = Math.max(0, Math.min(100, ((total - left) / total) * 100));
    let color = left <= 0 ? "red" : left <= 3 ? "orange" : "green";
    return `<div class="progress"><div class="progress-bar" style="width:${percent}%; background:${color};"></div></div>`;
}

function copyToClipboard(text) {
    navigator.clipboard.writeText(text);
    alert("Copied to clipboard!");
}

// Refunds
function calculateRefunds() {
    let startDate = document.getElementById("refundDate").value;
    if (!startDate) return;
    let date = new Date(startDate);
    let methods = {
        "Card": 19,
        "Klarna": 15,
        "Apple Pay": 19,
        "PayPal": 15,
        "Clearpay": 15
    };
    let html = "";
    for (let method in methods) {
        let due = addDays(date, methods[method]);
        html += `<p>${method} Refund Due: ${formatUK(due)}</p>`;
    }
    document.getElementById("refundResults").innerHTML = html;
}

// Return Deadline
function calculateReturn() {
    let deliveryDate = document.getElementById("returnDate").value;
    if (!deliveryDate) return;
    let due = addDays(new Date(deliveryDate), 30);
    let daysLeft = Math.ceil((due - new Date()) / (1000 * 60 * 60 * 24));
    document.getElementById("returnResult").innerHTML =
        `Return Due: ${formatUK(due)} (${daysLeft} days left) ${getBadge(daysLeft)} 
        ${progressBar(30, daysLeft)} 
        <button onclick="copyToClipboard('Return Due: ${formatUK(due)}')">Copy</button>`;
}

// NRG Completion
function calculateNRG() {
    let lastTracked = document.getElementById("nrgDate").value;
    if (!lastTracked) return;
    let due = addDays(new Date(lastTracked), 11);
    let daysLeft = Math.ceil((due - new Date()) / (1000 * 60 * 60 * 24));
    document.getElementById("nrgResult").innerHTML =
        `NRG is 11 days since last tracked (UK) <br>NRG Due: ${formatUK(due)} (${daysLeft} days left) ${getBadge(daysLeft)}
        ${progressBar(11, daysLeft)} 
        <button onclick="copyToClipboard('NRG Due: ${formatUK(due)}')">Copy</button>`;
}

// PA Resolution
function calculatePA() {
    let dispatchDate = document.getElementById("paDate").value;
    if (!dispatchDate) return;
    let due = addDays(new Date(dispatchDate), 6);
    let daysLeft = Math.ceil((due - new Date()) / (1000 * 60 * 60 * 24));
    document.getElementById("paResult").innerHTML =
        `PA is 6 days since dispatch <br>PA Deadline: ${formatUK(due)} (${daysLeft} days left) ${getBadge(daysLeft)}
        ${progressBar(6, daysLeft)} 
        <button onclick="copyToClipboard('PA Deadline: ${formatUK(due)}')">Copy</button>`;
}
</script>

</body>
</html>

